// Tencent is pleased to support the open source community by making
// 蓝鲸智云 - 监控平台 (BlueKing - Monitor) available.
// Copyright (C) 2022 THL A29 Limited, a Tencent company. All rights reserved.
// Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License.
// You may obtain a copy of the License at http://opensource.org/licenses/MIT
// Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
// an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
// specific language governing permissions and limitations under the License.

package pipeline_test

import (
	"sync"
	"testing"

	"github.com/stretchr/testify/suite"

	"github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/define"
	"github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/models"
	_ "github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/template/etl"
	_ "github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/template/etl/basereport"
	_ "github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/template/etl/formatter"
	. "github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/testsuite"
)

// BaseReportPipelineSuite :
type BaseReportPipelineSuite struct {
	ETLPipelineSuite
}

// SetupTest :
func (s *BaseReportPipelineSuite) SetupTest() {
	s.ConsulConfig = `{"etl_config":"bk_system_basereport","result_table_list":[{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"cpu_detail","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.cpu_detail","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u8bbe\u5907\u540d","field_name":"device_name","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u7a7a\u95f2\u7387","field_name":"idle","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7b49\u5f85IO\u7684\u65f6\u95f4\u5360\u6bd4","field_name":"iowait","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u5206\u914d\u7ed9\u865a\u62df\u673a\u7684\u65f6\u95f4\u5360\u6bd4","field_name":"stolen","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7cfb\u7edf\u7a0b\u5e8f\u4f7f\u7528\u5360\u6bd4","field_name":"system","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"\u5355\u6838\u4f7f\u7528\u7387","field_name":"usage","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7528\u6237\u7a0b\u5e8f\u4f7f\u7528\u5360\u6bd4","field_name":"user","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"cpu_summary","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.cpu_summary","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u8bbe\u5907\u540d","field_name":"device_name","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u7a7a\u95f2\u7387","field_name":"idle","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7b49\u5f85IO\u7684\u65f6\u95f4\u5360\u6bd4","field_name":"iowait","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u5206\u914d\u7ed9\u865a\u62df\u673a\u7684\u65f6\u95f4\u5360\u6bd4","field_name":"stolen","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7cfb\u7edf\u7a0b\u5e8f\u4f7f\u7528\u5360\u6bd4","field_name":"system","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"\u4f7f\u7528\u7387","field_name":"usage","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7528\u6237\u7a0b\u5e8f\u4f7f\u7528\u5360\u6bd4","field_name":"user","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"disk","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.disk","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u8bbe\u5907\u540d","field_name":"device_name","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u7a7a\u95f2\u7a7a\u95f4\u5927\u5c0f","field_name":"free","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u5df2\u7528\u7a7a\u95f4\u5360\u6bd4","field_name":"in_use","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"\u603b\u7a7a\u95f4\u5927\u5c0f","field_name":"total","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u5df2\u7528\u7a7a\u95f4\u5927\u5c0f","field_name":"used","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"env","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.env","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u65f6\u533a\u57ce\u5e02","field_name":"city","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u8fdb\u7a0b\u6570","field_name":"procs","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"\u673a\u5668\u65f6\u533a","field_name":"timezone","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u542f\u52a8\u65f6\u95f4","field_name":"uptime","is_config_by_user":true,"tag":"metric","type":"int","unit":"s"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"inode","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.inode","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u8bbe\u5907\u540d","field_name":"device_name","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u53ef\u7528inode\u6570\u91cf","field_name":"free","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u5df2\u7528inode\u5360\u6bd4","field_name":"in_use","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"\u603binode\u6570\u91cf","field_name":"total","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"\u5df2\u7528inode\u6570\u91cf","field_name":"used","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"io","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.io","field_list":[{"default_value":null,"description":"\u5e73\u5747\u961f\u5217\u957f\u5ea6","field_name":"avgqu_sz","is_config_by_user":true,"tag":"metric","type":"double","unit":""},{"default_value":null,"description":"\u5e73\u5747\u6570\u636e\u5927\u5c0f","field_name":"avgrq_sz","is_config_by_user":true,"tag":"metric","type":"double","unit":"sector"},{"default_value":null,"description":"\u5e73\u5747\u7b49\u5f85\u65f6\u957f","field_name":"await","is_config_by_user":true,"tag":"metric","type":"double","unit":"ms"},{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u8bbe\u5907\u540d","field_name":"device_name","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u8bfb\u901f\u7387","field_name":"rkb_s","is_config_by_user":true,"tag":"metric","type":"double","unit":"B\/s"},{"default_value":null,"description":"\u8bfb\u6b21\u6570","field_name":"r_s","is_config_by_user":true,"tag":"metric","type":"double","unit":"\u6b21\/s"},{"default_value":null,"description":"\u5e73\u5747\u670d\u52a1\u65f6\u957f","field_name":"svctm","is_config_by_user":true,"tag":"metric","type":"double","unit":"ms"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"IO\u4f7f\u7528\u7387","field_name":"util","is_config_by_user":true,"tag":"metric","type":"double","unit":""},{"default_value":null,"description":"\u5199\u901f\u7387","field_name":"wkb_s","is_config_by_user":true,"tag":"metric","type":"double","unit":"B\/s"},{"default_value":null,"description":"\u5199\u6b21\u6570","field_name":"w_s","is_config_by_user":true,"tag":"metric","type":"double","unit":"\u6b21\/s"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"load","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.load","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"1\u5206\u949f\u5e73\u5747\u8d1f\u8f7d","field_name":"load1","is_config_by_user":true,"tag":"metric","type":"float","unit":""},{"default_value":null,"description":"15\u5206\u949f\u5e73\u5747\u8d1f\u8f7d","field_name":"load15","is_config_by_user":true,"tag":"metric","type":"float","unit":""},{"default_value":null,"description":"5\u5206\u949f\u5e73\u5747\u8d1f\u8f7d","field_name":"load5","is_config_by_user":true,"tag":"metric","type":"float","unit":""},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"mem","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.mem","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"buffered\u5927\u5c0f","field_name":"buffer","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"cached\u5927\u5c0f","field_name":"cached","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u7269\u7406\u5185\u5b58\u7a7a\u95f2\u91cf","field_name":"free","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u53ef\u7528\u7387","field_name":"pct_usable","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u4f7f\u7528\u5360\u6bd4","field_name":"pct_used","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7269\u7406\u5185\u5b58\u5df2\u7528\u5360\u6bd4","field_name":"psc_pct_used","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u7269\u7406\u5185\u5b58\u5df2\u7528\u91cf","field_name":"psc_used","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"\u7269\u7406\u5185\u5b58\u603b\u5927\u5c0f","field_name":"total","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u53ef\u7528\u91cf","field_name":"usable","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u4f7f\u7528\u91cf","field_name":"used","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"net","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.net","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u8bbe\u5907\u540d","field_name":"device_name","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u7f51\u5361\u5165\u5305\u91cf","field_name":"speed_packets_recv","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a\/s"},{"default_value":null,"description":"\u7f51\u5361\u51fa\u5305\u91cf","field_name":"speed_packets_sent","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a\/s"},{"default_value":null,"description":"\u7f51\u5361\u5165\u6d41\u91cf","field_name":"speed_recv","is_config_by_user":true,"tag":"metric","type":"int","unit":"B\/s"},{"default_value":null,"description":"\u7f51\u5361\u51fa\u6d41\u91cf","field_name":"speed_sent","is_config_by_user":true,"tag":"metric","type":"int","unit":"B\/s"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"netstat","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.netstat","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"closed\u8fde\u63a5\u6570","field_name":"cur_tcp_closed","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"closewait\u8fde\u63a5\u6570","field_name":"cur_tcp_closewait","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"closing\u8fde\u63a5\u6570","field_name":"cur_tcp_closing","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"estab\u8fde\u63a5\u6570","field_name":"cur_tcp_estab","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"finwait1\u8fde\u63a5\u6570","field_name":"cur_tcp_finwait1","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"finwait2\u8fde\u63a5\u6570","field_name":"cur_tcp_finwait2","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"lastact\u8fde\u63a5\u6570","field_name":"cur_tcp_lastack","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"listen\u8fde\u63a5\u6570","field_name":"cur_tcp_listen","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"synrecv\u8fde\u63a5\u6570","field_name":"cur_tcp_syn_recv","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"synsent\u8fde\u63a5\u6570","field_name":"cur_tcp_syn_sent","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"timewait\u8fde\u63a5\u6570","field_name":"cur_tcp_timewait","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"udp\u63a5\u6536\u5305\u91cf","field_name":"cur_udp_indatagrams","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"udp\u53d1\u9001\u5305\u91cf","field_name":"cur_udp_outdatagrams","is_config_by_user":true,"tag":"metric","type":"int","unit":"\u4e2a"},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""}]},{"schema_type":"fixed","shipper_list":[{"cluster_config":{"domain_name":"127.0.0.1","port":8086},"storage_config":{"real_table_name":"swap","database":"system"},"cluster_type":"influxdb"}],"result_table":"system.swap","field_list":[{"default_value":null,"description":"\u4e1a\u52a1ID","field_name":"bk_biz_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u4e91\u533a\u57dfID","field_name":"bk_cloud_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"\u5f00\u53d1\u5546ID","field_name":"bk_supplier_id","is_config_by_user":true,"tag":"dimension","type":"int","unit":""},{"default_value":null,"description":"SWAP\u7a7a\u95f2\u91cf","field_name":"free","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"\u4e3b\u673a\u540d","field_name":"hostname","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"\u91c7\u96c6\u5668IP\u5730\u5740","field_name":"ip","is_config_by_user":true,"tag":"dimension","type":"string","unit":""},{"default_value":null,"description":"SWAP\u5df2\u7528\u5360\u6bd4","field_name":"pct_used","is_config_by_user":true,"tag":"metric","type":"double","unit":"%"},{"default_value":null,"description":"\u6570\u636e\u4e0a\u62a5\u65f6\u95f4","field_name":"time","is_config_by_user":true,"tag":"","type":"timestamp","unit":""},{"default_value":null,"description":"SWAP\u603b\u91cf","field_name":"total","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"},{"default_value":null,"description":"SWAP\u5df2\u7528\u91cf","field_name":"used","is_config_by_user":true,"tag":"metric","type":"int","unit":"Byte"}]}],"mq_config":{"cluster_config":{"domain_name":"kafka.service.consul","port":9092},"storage_config":{"topic":"0bkmonitor_10010","partition":1},"cluster_type":"kafka"},"data_id":1001}
`
	s.PipelineName = "bk_system_basereport"
	s.ETLPipelineSuite.SetupTest()
}

// TestRun :
func (s *BaseReportPipelineSuite) TestRun() {
	s.StoreHost(&models.CCHostInfo{
		IP:      "127.0.0.1",
		CloudID: 0,
	}).AnyTimes()

	var wg sync.WaitGroup

	wg.Add(1)
	s.FrontendPulled = `
{"bkmonitorbeat":{"address":["127.0.0.1"],"hostname":"rbtnode1","name":"rbtnode1","version":"10.1.7"},"bizid":0,"cloudid":0,"data":{"city":"","country":"","cpu":{"cpuinfo":[{"cacheSize":512,"coreId":"0","cores":1,"cpu":0,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"1","cores":1,"cpu":1,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"2","cores":1,"cpu":2,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"3","cores":1,"cpu":3,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"4","cores":1,"cpu":4,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"5","cores":1,"cpu":5,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"6","cores":1,"cpu":6,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"},{"cacheSize":512,"coreId":"7","cores":1,"cpu":7,"family":"23","flags":["fpu","vme","de","pse","tsc","msr","pae","mce","cx8","apic","sep","mtrr","pge","mca","cmov","pat","pse36","clflush","mmx","fxsr","sse","sse2","ht","syscall","nx","mmxext","fxsr_opt","pdpe1gb","rdtscp","lm","art","rep_good","nopl","extd_apicid","eagerfpu","pni","pclmulqdq","ssse3","fma","cx16","sse4_1","sse4_2","x2apic","movbe","popcnt","aes","xsave","avx","f16c","rdrand","hypervisor","lahf_lm","cmp_legacy","cr8_legacy","abm","sse4a","misalignsse","3dnowprefetch","osvw","fsgsbase","bmi1","avx2","smep","bmi2","rdseed","adx","smap","clflushopt","sha_ni","xsaveopt","xsavec","xgetbv1","arat"],"mhz":1999.998,"microcode":"0x1000065","model":"1","modelName":"AMD EPYC Processor","physicalId":"0","stepping":2,"vendorId":"AuthenticAMD"}],"per_stat":[{"cpu":"cpu0","guest":0,"guestNice":0,"idle":872536.15,"iowait":36946.34,"irq":0,"nice":2.2,"softirq":7385.74,"steal":0,"stolen":0,"system":309288.1,"user":1674236.07},{"cpu":"cpu1","guest":0,"guestNice":0,"idle":866955.68,"iowait":23757.09,"irq":0,"nice":1.83,"softirq":7176.09,"steal":0,"stolen":0,"system":308080.67,"user":1695497.29},{"cpu":"cpu2","guest":0,"guestNice":0,"idle":869737.54,"iowait":18175,"irq":0,"nice":0.71,"softirq":7085.72,"steal":0,"stolen":0,"system":308229.8,"user":1698334.62},{"cpu":"cpu3","guest":0,"guestNice":0,"idle":874380.96,"iowait":15166.22,"irq":0,"nice":1.11,"softirq":7068.8,"steal":0,"stolen":0,"system":308228.63,"user":1696628.7},{"cpu":"cpu4","guest":0,"guestNice":0,"idle":878453.31,"iowait":13191.35,"irq":0,"nice":0.84,"softirq":7025.14,"steal":0,"stolen":0,"system":308446.82,"user":1694366.76},{"cpu":"cpu5","guest":0,"guestNice":0,"idle":888000.12,"iowait":12007.12,"irq":0,"nice":1.22,"softirq":7009.57,"steal":0,"stolen":0,"system":308333.94,"user":1685959.45},{"cpu":"cpu6","guest":0,"guestNice":0,"idle":886483.11,"iowait":10873.18,"irq":0,"nice":0.91,"softirq":6959.51,"steal":0,"stolen":0,"system":308360.43,"user":1688828.64},{"cpu":"cpu7","guest":0,"guestNice":0,"idle":902443.55,"iowait":10287.39,"irq":0,"nice":0.84,"softirq":7135.51,"steal":0,"stolen":0,"system":307896.81,"user":1673205.75}],"per_usage":[62.17127444281228,65.29372045791891,70.37533512099486,65.90450571652302,64.67828418154629,68.90982503418932,68.07795698900756,59.06945380961094],"total_stat":{"cpu":"cpu-total","guest":0,"guestNice":0,"idle":7038990.46,"iowait":140403.73,"irq":0,"nice":9.68,"softirq":56846.1,"steal":0,"stolen":0,"system":2466865.22,"user":13507057.31},"total_usage":65.55378017024681},"datetime":"2019-03-24 16:53:13","disk":{"diskstat":{"sr0":{"avgqu_sz":0,"avgrq_sz":0,"await":0,"ioTime":403,"iopsInProgress":0,"major":11,"mergedReadCount":0,"mergedWriteCount":0,"minor":0,"name":"sr0","readBytes":39241728,"readCount":1205,"readSectors":76644,"readTime":522,"serialNumber":"QEMU_DVD-ROM_QM00002","speedByteRead":0,"speedByteWrite":0,"speedIORead":0,"speedIOWrite":0,"svctm":0,"util":0,"weightedIoTime":518,"writeBytes":0,"writeCount":0,"writeSectors":0,"writeTime":0},"vda":{"avgqu_sz":1.8160086338008283,"avgrq_sz":51.01239275500477,"await":25.936367969494757,"ioTime":214365511,"iopsInProgress":0,"major":253,"mergedReadCount":205,"mergedWriteCount":125550757,"minor":0,"name":"vda","readBytes":11358557184,"readCount":563481,"readSectors":22184682,"readTime":20451081,"serialNumber":"","speedByteRead":0,"speedByteWrite":1828817.4979689727,"speedIORead":0,"speedIOWrite":70.02042019231129,"svctm":2.008102955195424,"util":0.14060821271220564,"weightedIoTime":2537430897,"writeBytes":1775118327808,"writeCount":106935948,"writeSectors":3467027984,"writeTime":2517017126},"vda1":{"avgqu_sz":1.8011568287552713,"avgrq_sz":60.21040787623066,"await":30.362587904360055,"ioTime":194498787,"iopsInProgress":0,"major":253,"mergedReadCount":205,"mergedWriteCount":125550757,"minor":1,"name":"vda1","readBytes":11357488128,"readCount":563452,"readSectors":22182594,"readTime":20451004,"serialNumber":"","speedByteRead":0,"speedByteWrite":1828817.4979689727,"speedIORead":0,"speedIOWrite":59.323783075230374,"svctm":2.191842475386779,"util":0.13002838754492127,"weightedIoTime":2512244415,"writeBytes":1775118327808,"writeCount":92797554,"writeSectors":3467027984,"writeTime":2491809838}},"partition":[{"device":"/dev/vda1","fstype":"ext4","mountpoint":"/","opts":"rw,noatime,data=ordered"},{"device":"/dev/vda1","fstype":"ext4","mountpoint":"/data/bkee/public/paas_agent/docker/overlay","opts":"rw,noatime,data=ordered"}],"usage":[{"free":7893471232,"fstype":"ext2/ext3","inodesFree":3017996,"inodesTotal":3276800,"inodesUsed":258804,"inodesUsedPercent":7.8980712890625,"path":"/","total":52709421056,"used":42114895872,"usedPercent":84.21569891377511},{"free":7893471232,"fstype":"ext2/ext3","inodesFree":3017996,"inodesTotal":3276800,"inodesUsed":258804,"inodesUsedPercent":7.8980712890625,"path":"/data/bkee/public/paas_agent/docker/overlay","total":52709421056,"used":42114895872,"usedPercent":84.21569891377511}]},"env":{"crontab":[{"content":"*/1 * * * * /usr/local/qcloud/stargate/admin/start.sh \u003e /dev/null 2\u003e\u00261 \u0026\n0 0 * * * /usr/local/qcloud/YunJing/YDCrontab.sh \u003e /dev/null 2\u003e\u00261 \u0026\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch zk \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch rabbitmq \u003e/dev/null 2\u003e\u00261\n* * * * * /usr/local/gse/agent/bin/gsectl watch\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch es \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch beanstalk \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch etcd \u003e/dev/null 2\u003e\u00261\n*/10 * * * * /data/bkee/bkdata/dataapi/bin/update_cc_cache.sh\n\n# 定时删除ES中的过期数据\n0 */1 * * * /data/bkee/bkdata/dataapi/datatools/scripts/es_delete_expired_index.sh\n\n# 定时提前创建ES中的索引\n*/10 * * * * /data/bkee/bkdata/dataapi/datatools/scripts/es_create_mapping_ahead.sh\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch fta \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch consul \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch nfs \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch paas_agent \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch bkdata \u003e/dev/null 2\u003e\u00261\n* * * * * export INSTALL_PATH=/data/bkee; /data/bkee/bin/process_watch kafka \u003e/dev/null 2\u003e\u00261\n","user":"root"}],"host":"127.0.0.1 localhost.localdomain localhost\n127.0.0.1 localhost4.localdomain4 localhost4\n\n::1 localhost.localdomain localhost\n::1 localhost6.localdomain6 localhost6\n127.0.0.1 jobsee-dev.bktencent.com\n127.0.0.1   rbtnode1\n127.0.0.1 paasee-dev.bktencent.com\n127.0.0.1 cmdbee-dev.bktencent.com\n127.0.0.1 jobee-dev.bktencent.com\n","route":"Kernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         127.0.0.1        0.0.0.0         UG    0      0        0 eth0\n127.0.0.1        0.0.0.0         255.255.255.0   U     0      0        0 eth0\n169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0\n"},"load":{"load_avg":{"load1":7.57,"load15":6.7,"load5":7.07}},"mem":{"meminfo":{"active":28562444288,"available":7240462336,"buffers":278593536,"cached":5399138304,"dirty":27095040,"free":1196331008,"inactive":2441691136,"total":33567973376,"used":26327511040,"usedPercent":78.43044542815119,"wired":0,"writeback":0,"writebacktmp":0},"vmstat":{"free":0,"sin":0,"sout":0,"total":0,"used":0,"usedPercent":0}},"net":{"dev":[{"bytesRecv":774825383639,"bytesSent":826212683718,"dropin":0,"dropout":0,"errin":0,"errout":0,"fifoin":0,"fifoout":0,"name":"eth0","packetsRecv":4941166988,"packetsSent":3050639827,"speedPacketsRecv":2691,"speedPacketsSent":1633,"speedRecv":614946,"speedSent":745026},{"bytesRecv":373072806687,"bytesSent":373072806687,"dropin":0,"dropout":0,"errin":0,"errout":0,"fifoin":0,"fifoout":0,"name":"lo","packetsRecv":2161682569,"packetsSent":2161682569,"speedPacketsRecv":2120,"speedPacketsSent":2120,"speedRecv":662776,"speedSent":662776}],"interface":[{"addrs":[{"addr":"127.0.0.1/8"}],"flags":["up","loopback"],"hardwareaddr":"","mtu":65536,"name":"lo"},{"addrs":[{"addr":"127.0.0.1/24"}],"flags":["up","broadcast","multicast"],"hardwareaddr":"52:54:00:f8:42:96","mtu":1500,"name":"eth0"}],"netstat":{"close":0,"closeWait":241,"closing":0,"established":2640,"finWait1":0,"finWait2":1,"lastAck":0,"listen":59,"synRecv":0,"syncSent":0,"timeWait":2723},"protocolstat":{"udp":{"inCsumErrors":0,"inDatagrams":3204,"inErrors":0,"noPorts":0,"outDatagrams":3204,"rcvbufErrors":0,"sndbufErrors":0}}},"system":{"docker":{"Client":{"ApiVersion":"1.24","GoVersion":"go1.6.4","Version":"1.12.4"},"Server":{"ApiVersion":"1.24","GoVersion":"go1.6.4","Version":"1.12.4"}},"info":{"bootTime":1550498043,"hostid":"285FDC26-DFA3-4C52-9617-F454BE4DF214","hostname":"rbtnode1","kernelVersion":"3.10.0-693.el7.x86_64","os":"linux","platform":"centos","platformFamily":"rhel","platformVersion":"7.4.1708","procs":498,"systemtype":"64-bit","uptime":2919505,"virtualizationRole":"","virtualizationSystem":""}},"timezone":8,"utctime":"2019-03-24 08:53:13"},"dataid":1001,"gseindex":48591,"ip":"127.0.0.1","type":"basereport"}
`
	wg.Add(23)
	pipe := s.BuildPipe(func(payload define.Payload) {
		wg.Done()
	}, func(i map[string]interface{}) {
		wg.Done()
	})

	s.RunPipe(pipe, wg.Wait)
}

// TestBaseReportPipelineSuite :
func TestBaseReportPipelineSuite(t *testing.T) {
	suite.Run(t, new(BaseReportPipelineSuite))
}
