// Tencent is pleased to support the open source community by making
// 蓝鲸智云 - 监控平台 (BlueKing - Monitor) available.
// Copyright (C) 2022 THL A29 Limited, a Tencent company. All rights reserved.
// Licensed under the MIT License (the "License"); you may not use this file except in compliance with the License.
// You may obtain a copy of the License at http://opensource.org/licenses/MIT
// Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
// an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
// specific language governing permissions and limitations under the License.

package pipeline_test

import (
	"sync"
	"testing"

	"github.com/stretchr/testify/suite"

	"github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/define"
	"github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/models"
	. "github.com/TencentBlueKing/bkmonitor-datalink/pkg/transfer/testsuite"
)

// ExporterPipelineSuite :
type ExporterPipelineSuite struct {
	FreeSchemaETLPipelineSuite
}

// SetupTest :
func (s *ExporterPipelineSuite) SetupTest() {
	s.PipelineName = "bk_exporter"
	s.ConsulConfig = `{"etl_config":"bk_exporter","result_table_list":[{"schema_type":"free","shipper_list":[{"cluster_config":{"domain_name":"influx.service.consul","port":8086},"storage_config":{"real_table_name":"consul1","database":"exportor"},"cluster_type":"influxdb"}],"result_table":"exportor.consul1","field_list":[{"default_value":"-1","type":"int","is_config_by_user":true,"tag":"","field_name":"bk_biz_id"},{"default_value":"","type":"timestamp","is_config_by_user":true,"tag":"","field_name":"time"},{"type":"int","is_config_by_user":true,"tag":"metric","field_name":"consul_catalog_nodes_up"},{"type":"int","is_config_by_user":true,"tag":"metric","field_name":"consul_catalog_nodes_critical"},{"type":"string","is_config_by_user":true,"tag":"dimension","field_name":"consul_datacenter"},{"type":"string","is_config_by_user":true,"tag":"dimension","field_name":"consul_service_id"}]}],"mq_config":{"cluster_config":{"domain_name":"kafka.service.consul","port":9092},"storage_config":{"topic":"bkmonitor_10140","partition":1},"cluster_type":"kafka"},"data_id":1014}`
	s.FreeSchemaETLPipelineSuite.SetupTest()
}

// TestUsage :
func (s *ExporterPipelineSuite) TestUsage() {
	s.StoreHost(&models.CCHostInfo{
		IP: "127.0.0.1",
	}).AnyTimes()
	s.StoreHost(&models.CCHostInfo{
		IP: "127.0.0.14",
	}).AnyTimes()

	var wg sync.WaitGroup
	wg.Add(2)
	s.FrontendPulled = `
{"@timestamp":"2019-02-06T07:21:56.241Z","bkmonitorbeat":{"address":["127.0.0.1"],"hostname":"zk-2","name":"zk-2","version":"6.0.12"},"bizid":0,"cloudid":0,"dataid":2011,"gseindex":207499,"ip":"127.0.0.1","metricset":{"host":"127.0.0.1:9272","module":"prometheus","name":"collector","rtt":211344},"prometheus":{"collector":{"metrics":[{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":6.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":2.000000},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":5.124331},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.409470},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.335530},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":0.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.252439},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":2.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":0.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":0.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":1.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":0.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.131547},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":3.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":0.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.027523},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":5.124331},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":0.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":10.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":0.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":0.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":10.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":0.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.634718},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":3.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":10.000000},{"key":"consul_peers","labels":{"consul_datacenter":"dc","mode":"follower"},"value":3.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":3.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":6.000000},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.409470},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":0.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":1.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":2.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":1.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.354177},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.245813},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":3.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.252439},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":0.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.371460},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":3.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":3.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":0.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":7.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":1.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":0.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.027523},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.325025},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":3.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":1.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.335530},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":0.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":9.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":4.522797},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.466117},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":2.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":3.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":0.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.325025},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.371460},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.634718},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":1.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":6.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.466117},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":1.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.245813},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":0.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":4.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":0.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":0.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.354177},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":1.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":1.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":9.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":1.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":0.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":0.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":0.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":7.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":3.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":2.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":3.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":0.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":1.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":0.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":1.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":9.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":1.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":0.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.388478},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":3.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":10.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":0.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":9.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.396917},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.131547}],"namespace":"consul_exporter"}},"type":"metricsets","group_info": [{"tag": "aaa", "tag1": "aaa1"},{"tag": "bbb", "tag1": "bbb1"}]}
{"@timestamp":"2019-02-06T07:22:40.483Z","bkmonitorbeat":{"address":["127.0.0.14"],"hostname":"zk-1","name":"zk-1","version":"6.0.12"},"bizid":0,"cloudid":0,"dataid":2011,"gseindex":214407,"ip":"127.0.0.14","metricset":{"host":"127.0.0.1:9272","module":"prometheus","name":"collector","rtt":152365},"prometheus":{"collector":{"metrics":[{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":2.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":0.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.352399},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":0.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":3.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.624732},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":9.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.233837},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":0.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":3.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":6.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":10.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":0.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":4.352399},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.743897},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":1.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":6.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":3.968013},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":6.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":4.352399},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":3.968013},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":3.937696},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":5.081374},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":1.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":9.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":1.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":4.352399},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":1.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":3.000000},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.356056},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":0.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.218506},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":4.352399},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":0.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":9.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":0.000000},{"key":"consul_peers","labels":{"consul_datacenter":"dc","mode":"leader"},"value":3.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":1.000161},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":2.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":4.769534},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":3.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.357820},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":0.000000},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":4.769534},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.218506},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":1.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":3.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":0.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.233837},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":1.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":10.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":0.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"ceph"},"value":3.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":0.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":4.769534},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":3.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":7.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":9.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":3.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"zk-3"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":2.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":3.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":1.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":4.769534},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":1.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":3.937696},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.297186},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"nfs"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":0.000000},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":10.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":3.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":0.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"es"},"value":0.000000},{"key":"consul_net_node_latency_min","labels":{"consul_datacenter":"dc"},"value":0.357820},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":0.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":1.000161},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":0.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":4.769534},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"mysql-1"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":0.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":4.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb-direct"},"value":1.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"redis_cluster"},"value":0.000000},{"key":"consul_catalog_services_critical","labels":{"consul_datacenter":"dc","consul_node_id":"zk-1"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"gse"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":1.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.297186},{"key":"consul_catalog_services_up","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":7.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":0.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"zk-2"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"beanstalk"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":2.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.356056},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":1.000000},{"key":"consul_net_node_latency_median","labels":{"consul_datacenter":"dc"},"value":4.743897},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"dataapi"},"value":0.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"influxdb"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"license"},"value":0.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"monitor"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"appo"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":0.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"mysql"},"value":1.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"fta"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"paas"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"job"},"value":0.000000},{"key":"consul_net_node_latency_max","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"rabbitmq"},"value":1.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"job-direct"},"value":0.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"etcd"},"value":0.000000},{"key":"consul_net_node_latency_p25","labels":{"consul_datacenter":"dc"},"value":0.624732},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":2.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"consul"},"value":0.000000},{"key":"consul_net_node_latency_p75","labels":{"consul_datacenter":"dc"},"value":5.081374},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":0.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"iam"},"value":0.000000},{"key":"consul_catalog_services_passing","labels":{"consul_datacenter":"dc","consul_node_id":"nginx-1"},"value":10.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":1.000000},{"key":"consul_catalog_services_warning","labels":{"consul_datacenter":"dc","consul_node_id":"paas-1"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"redis"},"value":0.000000},{"key":"consul_net_node_latency_p90","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":3.000000},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"kafka"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":0.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"zk"},"value":0.000000},{"key":"consul_net_node_latency_p99","labels":{"consul_datacenter":"dc"},"value":5.336058},{"key":"consul_catalog_nodes_up","labels":{"consul_datacenter":"dc","consul_service_id":"mongodb"},"value":3.000000},{"key":"consul_catalog_nodes_critical","labels":{"consul_datacenter":"dc","consul_service_id":"appt"},"value":0.000000},{"key":"consul_net_node_latency_p95","labels":{"consul_datacenter":"dc"},"value":5.915834},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"cmdb"},"value":1.000000},{"key":"consul_catalog_nodes_passing","labels":{"consul_datacenter":"dc","consul_service_id":"databus"},"value":1.000000},{"key":"consul_catalog_nodes_warning","labels":{"consul_datacenter":"dc","consul_service_id":"paas-direct"},"value":0.000000}],"namespace":"consul_exporter"}},"type":"metricsets","group_info": [{"tag": "aaa", "tag1": "aaa1"},{"tag": "bbb", "tag1": "bbb1"}]}
`
	s.DisableReportData()

	wg.Add(232)
	pipe := s.BuildPipe(func(payload define.Payload) {
		wg.Done()
	}, func(i map[string]interface{}) {
		wg.Done()
	})

	s.RunPipe(pipe, wg.Wait)
}

// TestExporterPipelineSuite :
func TestExporterPipelineSuite(t *testing.T) {
	suite.Run(t, new(ExporterPipelineSuite))
}
